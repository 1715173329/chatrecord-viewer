import Head from 'next/head'
import styles from '../styles/Home.module.css'
import {GetServerSideProps, InferGetServerSidePropsType} from 'next'
import DateGroup from '../types/DateGroup'
import DateContainer from '../components/DateContainer'
import getHistory, {ErrorRet, OkRet} from '../utils/getHistory'
import Error from 'next/error'

export default function Home({data}: { data: ErrorRet | OkRet }) {
    return (
        <div className={styles.container}>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app"/>
                <link rel="icon" href="/favicon.ico"/>
            </Head>
            {data.error ?
                <Error statusCode={500} title={data.data}/> :
                <div className={styles.container}>
                    {data.data.map(e => <DateContainer group={e} key={e.date}/>)}
                </div>
            }
        </div>
    )
}

export const getServerSideProps: GetServerSideProps = async (context) => {
    if (!context.query.res)
        return {
            notFound: true,
        }

    const data = await getHistory(context.query.res as string)

    return {
        props: {
            data,
        },
    }
}
